<section id="participa" class="bg-slate-100 py-16 md:py-24">
  <div class="container mx-auto px-6 flex max-w-[512px] flex-col items-center">
    <h2 class="text-titulo-mobile md:text-titulo font-montserrat font-bold text-azul-marino-oscuro mb-8 text-center">
      Danos tú opinion
    </h2>

    <div class="bg-white p-8 md:p-10 rounded-lg shadow-md w-full max-w-2xl">
      <form id="opinion-form">

        <div class="mb-8">
          <p class="font-semibold text-gray-800 mb-3">Saldrá usted a votar en las próximas elecciones?</p>
          <div class="flex flex-col sm:flex-row sm:space-x-6 space-y-2 sm:space-y-0">
            <label class="flex items-center space-x-2 cursor-pointer">
              <input type="radio" name="votara" value="si" class="hidden peer" required>
              <span class="w-5 h-5 border-2 border-gray-300 rounded-full grid place-content-center hover:border-blue-600 peer-checked:bg-blue-600 peer-checked:border-blue-600 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 text-white opacity-0 peer-checked:opacity-100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
              </span>
              <span>Sí</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer">
              <input type="radio" name="votara" value="no" class="hidden peer">
              <span class="w-5 h-5 border-2 border-gray-300 rounded-full grid place-content-center hover:border-blue-600 peer-checked:bg-blue-600 peer-checked:border-blue-600 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 text-white opacity-0 peer-checked:opacity-100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
              </span>
              <span>No</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer">
              <input type="radio" name="votara" value="no_estoy_seguro" class="hidden peer">
              <span class="w-5 h-5 border-2 border-gray-300 rounded-full grid place-content-center hover:border-blue-600 peer-checked:bg-blue-600 peer-checked:border-blue-600 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 text-white opacity-0 peer-checked:opacity-100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
              </span>
              <span>No estoy seguro/a</span>
            </label>
          </div>
        </div>

        <div class="mb-8">
          <p class="font-semibold text-gray-800 mb-3">Cómo califica la gestión del actual alcalde?</p>
          <div class="grid grid-cols-2 sm:grid-cols-3 gap-x-6 gap-y-2">
            {[ "Excelente", "Buena", "Regular", "Mala", "Muy mala" ].map(opcion => (
              <label class="flex items-center space-x-2 cursor-pointer">
                <input type="radio" name="calificacion_gestion" value={opcion.toLowerCase()} class="hidden peer" required>
                <span class="w-5 h-5 border-2 border-gray-300 rounded-full grid place-content-center hover:border-blue-600 peer-checked:bg-blue-600 peer-checked:border-blue-600 transition">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 text-white opacity-0 peer-checked:opacity-100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
                </span>
                <span>{opcion}</span>
              </label>
            ))}
          </div>
        </div>
        
        <div class="mb-8">
            <p class="font-semibold text-gray-800 mb-3">Apoyará usted al alcalde en su reelección?</p>
            <div class="flex space-x-6">
                 <label class="flex items-center space-x-2 cursor-pointer">
                    <input type="radio" name="apoyara_reeleccion" value="si" class="hidden peer" required>
                    <span class="w-5 h-5 border-2 border-gray-300 rounded-full grid place-content-center hover:border-blue-600 peer-checked:bg-blue-600 peer-checked:border-blue-600 transition">
                      <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 text-white opacity-0 peer-checked:opacity-100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
                    </span>
                    <span>Sí</span>
                </label>
                <label class="flex items-center space-x-2 cursor-pointer">
                    <input type="radio" name="apoyara_reeleccion" value="no" class="hidden peer">
                    <span class="w-5 h-5 border-2 border-gray-300 rounded-full grid place-content-center hover:border-blue-600 peer-checked:bg-blue-600 peer-checked:border-blue-600 transition">
                      <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 text-white opacity-0 peer-checked:opacity-100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
                    </span>
                    <span>No</span>
                </label>
            </div>
        </div>
        
        <div class="mb-8">
          <label for="sugerencia" class="block font-semibold text-gray-800 mb-3">¿Hay algo más que le gustaría comentarnos o sugerir para el municipio? (Opcional)</label>
          <textarea id="sugerencia" name="sugerencia" rows="4" class="w-full border-2 border-gray-300 rounded-md p-2 focus:border-amarillo-dorado focus:outline-none focus:ring-1 focus:ring-amarillo-dorado/50 transition"></textarea>
        </div>

        <div class="flex flex-col items-center">
            <button type="submit" class="bg-amarillo-dorado font-open-sans font-bold py-3 px-10 hover:bg-amber-600 transition-colors duration-300 text-gray-900 rounded-md">
                Enviar
            </button>
            <div id="form-status" class="mt-4 text-center text-sm font-semibold"></div>
        </div>
      </form>
    </div>
  </div>

</section>

<script>
  const form = document.getElementById('opinion-form');
  const formStatus = document.getElementById('form-status');

  form.addEventListener('submit', async function(event) {
    event.preventDefault(); // Evita que la página se recargue

    formStatus.textContent = 'Enviando...';
    formStatus.style.color = 'inherit';
    const formData = new FormData(form);

    try {
      // Enviamos los datos a nuestra propia API en Astro
      const response = await fetch('/api/opinion', {
        method: 'POST',
        body: formData
      });

      const resultText = await response.text();

      if (response.ok) {
        formStatus.textContent = resultText;
        formStatus.style.color = 'green';
        form.reset(); // Limpia el formulario
      } else {
        throw new Error(resultText);
      }
    } catch (error) {
      formStatus.textContent = error.message || 'Hubo un problema. Inténtalo de nuevo.';
      formStatus.style.color = 'red';
    }
  });
</script>